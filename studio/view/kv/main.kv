#:import asynckivy kivymd.utils.asynckivy

<ScreenMain>:
    md_bg_color: "#262626"

    MDBoxLayout:
        orientation: "vertical"

        MDTopAppBar:
            title: "Cam Live"
            md_bg_color: "#484848"
            left_action_items: [["home", lambda x: root.callWelcome(), "Accueil"]]
            right_action_items:
                [["plus-outline", lambda x: app.open_cam(), "Ajouter Caméra"], ["web", lambda x: app.start_connexion(), "Connexion"],["cog-outline", lambda x: app.open_param(), "Paramètres"],["account-outline", lambda x: app.data.compte(), "Compte"]]

        MDBoxLayout:
            orientation: "horizontal"
            spacing: "10dp"
            padding: "10dp"

            MDBoxLayout:
                id: one_widget
                orientation: "vertical"
                md_bg_color: "#484848"
                spacing: "10dp"
                padding: "10dp"

                MDBoxLayout:
                    id: content_add_cam
                    orientation: "vertical"
                    md_bg_color: "#676767"
                    padding: "10dp"
                    spacing: "5dp"
                    size_hint_y: 0
                    opacity: 0.0

                    MDBoxLayout:
                        orientation: "horizontal"
                        spacing: "5dp"
                        padding: "5dp"

                        MDSpinner:
                            id: spinner
                            size_hint: None, None
                            size: dp(20), dp(20)
                            active: False
                            pos_hint: {'center_y': .5}
                        
                        IconButtonAction:
                            icon: "file-upload-outline"
                            icon_size: dp(20)
                            icon_color: "#4287f5"
                            on_release:
                                root.file_manager_open()

                        IconButtonAction:
                            id: list_camera
                            icon: "camera-outline"
                            icon_size: dp(20)
                            icon_color: "#4287f5"
                            on_release: app.listcamera()

                        ClickableTextFieldRound:
                            id: lien
                            size_hint_x: None
                            width: content_add_cam.width / 2
                            hint_text: "Video source"

                    MDBoxLayout:
                        orientation: "horizontal"
                        padding: dp(5)

                        MDTextField:
                            id: source_audio
                            hint_text: 'Audio source'
                            size_hint_x: .5
                        
                        MDBoxLayout:
                            orientation: "horizontal"
                            spacing: dp(2)
                        
                            MDCheckbox:
                                group: "lien"
                                id: check_ipwebcam
                                size_hint: None, None
                                size: dp(20), dp(20)
                                # on_active: root.on_checkbox_active("Objet", self.active)

                            MDLabel:
                                text: "[color=#4287f5]IPWebCam[/color]"
                                font_size: dp(10)
                                adaptive_width: True
                                markup: True

                        MDBoxLayout:
                            orientation: "horizontal"
                            spacing: dp(2)

                            MDCheckbox:
                                id: check_ip
                                group: "lien"
                                size_hint: None, None
                                size: dp(20), dp(20)
                                # on_active: root.on_checkbox_active("Objet", self.active)

                            MDLabel:
                                text: "[color=#4287f5]IP[/color]"
                                font_size: dp(10)
                                adaptive_width: True
                                markup: True
                            
                        MDBoxLayout:
                            orientation: "horizontal"
                            spacing: dp(2)
                            
                            MDCheckbox:
                                id: check_video
                                group: "lien"
                                size_hint: None, None
                                size: dp(20), dp(20)
                                # on_active: root.on_checkbox_active("Objet", self.active)

                            MDLabel:
                                text: "[color=#4287f5]Video[/color]"
                                font_size: dp(10)
                                adaptive_width: True
                                markup: True
                            

                MDBoxLayout:
                    orientation: "vertical"
                    md_bg_color: "#676767"
                    padding: "10dp"
                    spacing: "5dp"
                    size_hint_y: .1

                    MDBoxLayout:
                        orientation: "horizontal"
                        md_bg_color: "#676767"

                        IconButtonAction:
                            id: microphone
                            icon: "microphone-outline"
                            icon_size: dp(20)
                            icon_color: "#4287f5"
                            on_release: app.listaudio()

                        MDLabel:
                            id: audio
                            text: "[color=#4287f5]Audio Cam 1[/color]"
                            font_size: dp(12)
                            size_hint_x: None
                            width: dp(80)
                            halign: "center"
                            markup: True

                        IconButtonAction:
                            id: shape
                            icon: "shape-outline"
                            icon_size: dp(20)
                            icon_color: "#4287f5"
                            on_release: app.listDropdown()

                        MDLabel:
                            id: label_format
                            text: "[color=#4287f5]Format[/color]"
                            font_size: dp(12)
                            size_hint_x: None
                            width: dp(80)
                            halign: "center"
                            markup: True

                        IconButtonAction:
                            id: save
                            icon: "content-save-outline"
                            icon_size: dp(20)
                            icon_color: "#4287f5"
                            on_release: app.data.camController.on_record()

                CardViewImage:
                    id: cardImage
                    size_hint: .9, .5
                    pos_hint: {"center_x": .5, "center_y": .5}

            MDBoxLayout:
                id: two_widget
                orientation: "vertical"
                md_bg_color: "#484848"


                MDScrollView:

                    MDGridLayout:
                        id: box_video
                        padding: dp(10)
                        spacing: dp(10)
                        size_hint_y: None
                        height: self.minimum_height
                        cols: 2
                
                MDBoxLayout:
                    id: content_controle
                    orientation: "vertical"
                    md_bg_color: "#484848"
                    size_hint_y: None
                    height: 0
                    opacity: 0

                    CardReducteImage:
                        id: camView



<CardViewImage>:
    md_bg_color: "#676767"
    padding: "10dp"
    spacing: "5dp"
    radius: [24]  # Coins arrondis pour un aspect moderne
    image: image
    lecture: lecture

    MDBoxLayout:
        orientation: "vertical"
        md_bg_color: "#676767"

        MDRelativeLayout:
            size_hint_y: None
            height: dp(10)

            MDCard:
                id: bage_image
                md_bg_color: "#fff000"
                size_hint: None, None
                width: dp(15)
                height: dp(15)
                radius: [24]
                pos_hint: {"center_x": .94, "center_y": .5}

        Image:
            id: image
            source: "studio/asset/texture_image.jpg"
            size_hint: None, None
            width: root.width - dp(50)
            height: root.height - dp(75)
            pos_hint: {"center_x": .5, "center_y": .5}

        MDBoxLayout:
            orientation: "horizontal"
            md_bg_color: "#676767"
            spacing: "10dp"
            padding: "10dp"

            IconButtonAction:
                id: microphone
                icon: "microphone-off"
                icon_size: dp(20)
                icon_color: "#4287f5"
                on_release: # Action à définir

            IconButtonAction:
                id: play
                icon: "play"
                icon_size: dp(20)
                icon_color: "#4287f5"
                on_release:
                    asynckivy.start(app.data.camController.on_play()) if self.icon == "play" else app.data.camController.on_break()
                    self.icon = "play" if self.icon == "play" else "pause"

            IconButtonAction:
                id: stop
                icon: "stop"
                icon_size: dp(20)
                icon_color: "#4287f5"
                on_release: app.data.camController.on_stop()

            MDLabel:
                id: lecture
                text: "[color=#ffffff]00:00:00[/color]"
                font_size: dp(12)
                size_hint_x: .3
                pos_hint: {"center_y": .8}
                markup: True
                adaptive_height: True
                halign: 'right'



<CheckItem>
    adaptive_height: True

    MDCheckbox:
        size_hint: None, None
        size: "48dp", "48dp"
        group: root.group

    MDLabel:
        text: root.text
        adaptive_height: True
        theme_text_color: "Custom"
        text_color: "#B2B6AE"
        pos_hint: {"center_y": .5}


<ClickableTextFieldRound>:
    size_hint_y: None
    height: text_field.height
    padding: dp(10)
     
    MDTextField:
        id: text_field
        hint_text: root.hint_text
        icon_left: "magnify"
        font_size: dp(10)
        icon_left_color_normal: "#4287f5"
        icon_left_color_focus: "#4287f5"
        hint_text_color_normal: "#4287f5"
        text_color_normal: "#4287f5"
        line_color_focus: "#4287f5"
        line_color_normal: "#4287f5"
        text: root.text
        # size_hint_x: None
        # width: root.width - dp(5)
        helper_text_mode: "on_focus"    
        on_text: 
            root.text = self.text

    IconButtonAction:
        icon: "magnify"
        icon_size: dp(20)
        style: "tonal"
        theme_bg_color: "Custom"
        theme_icon_color: "Custom"
        icon_color: "#4287f5"
        on_release: asynckivy.start(app.on_start_video())
        pos_hint: {"center_y": .5}
        pos: text_field.width - self.width + dp(5), 0
        theme_text_color: "Hint"



<ClickableTextFieldRoundRedute>:
    size_hint_y: None
    height: text_field.height
    padding: dp(10)
     
    MDTextField:

        id: text_field
        hint_text: root.hint_text
        icon_left: "magnify"
        font_size: dp(10)
        icon_left_color_normal: "#4287f5"
        icon_left_color_focus: "#4287f5"
        hint_text_color_normal: "#4287f5"
        text_color_normal: "#4287f5"
        line_color_focus: "#4287f5"
        line_color_normal: "#4287f5"
        text: root.text
        helper_text_mode: "on_focus"    
        size_hint_x: None
        width: dp(250) 

    IconButtonAction:
        icon: "magnify"
        icon_size: dp(20)
        style: "tonal"
        theme_bg_color: "Custom"
        theme_icon_color: "Custom"
        icon_color: "#4287f5"
        on_release: root.cam_reduct.on_start_video()
        pos_hint: {"center_y": .5}
        pos: text_field.width - self.width + dp(5), 0
        theme_text_color: "Hint"
